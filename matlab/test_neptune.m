% JPL Horizons
%

%****************************************************************************************************************************************
% Date__(UT)__HR:MN     Azimuth__(a-app)__Elevation  ObsSub-LON ObsSub-LAT    hEcl-Lon   hEcl-Lat  1-way_down_LT     ObsEcLon    ObsEcLat
%****************************************************************************************************************************************
% 2022-Apr-25 00:00 A    67.184076829 -16.204018416  287.562305 -22.596870  352.830228  -1.162750   255.13067860  354.3823446  -1.1340865
% 2022-Apr-25 01:00 N    80.715542464  -9.034889688  309.908781 -22.596460  352.830480  -1.162756   255.12688270  354.3836351  -1.1341149
% 2022-Apr-25 02:00 C    93.817773926  -1.584320657  332.255263 -22.596051  352.830733  -1.162762   255.12308106  354.3849232  -1.1341427
% 2022-Apr-25 03:00 *m  106.935874763   5.753059807  354.601748 -22.595644  352.830985  -1.162768   255.11927684  354.3862079  -1.1341695
% 2022-Apr-25 04:00 *m  120.489838386  12.584011172   16.948235 -22.595239  352.831238  -1.162774   255.11547316  354.3874888  -1.1341950
% 2022-Apr-25 05:00 *m  134.827864526  18.492636799   39.294724 -22.594836  352.831490  -1.162780   255.11167288  354.3887654  -1.1342191
% 2022-Apr-25 06:00 *m  150.143782525  23.039992493   61.641212 -22.594434  352.831743  -1.162786   255.10787843  354.3900377  -1.1342415
% 2022-Apr-25 07:00 *m  166.364039828  25.808259877   83.987700 -22.594033  352.831995  -1.162792   255.10409160  354.3913059  -1.1342624
% 2022-Apr-25 08:00 *m  183.086014643  26.495767875  106.334184 -22.593633  352.832248  -1.162797   255.10031348  354.3925702  -1.1342817
% 2022-Apr-25 09:00 *m  199.689112436  25.020882425  128.680666 -22.593234  352.832500  -1.162803   255.09654433  354.3938312  -1.1342998
% 2022-Apr-25 10:00 *m  215.606732425  21.555365922  151.027145 -22.592834  352.832753  -1.162809   255.09278359  354.3950899  -1.1343169
% 2022-Apr-25 11:00 *   230.555478783  16.456810067  173.373621 -22.592433  352.833006  -1.162815   255.08902990  354.3963471  -1.1343333
% 2022-Apr-25 12:00 *   244.572707009  10.159457746  195.720093 -22.592031  352.833258  -1.162821   255.08528122  354.3976038  -1.1343496
% 2022-Apr-25 13:00 *   257.921349742   3.096161316  218.066563 -22.591627  352.833511  -1.162827   255.08153494  354.3988609  -1.1343660
% 2022-Apr-25 14:00 *   270.983227646  -4.327204323  240.413032 -22.591223  352.833763  -1.162833   255.07778810  354.4001193  -1.1343831
% 2022-Apr-25 15:00 *   284.191885896 -11.720287695  262.759500 -22.590816  352.834016  -1.162839   255.07403753  354.4013798  -1.1344012
% 2022-Apr-25 16:00 *   297.991809515 -18.680201461  285.105970 -22.590408  352.834268  -1.162845   255.07028013  354.4026430  -1.1344206
% 2022-Apr-25 17:00 *   312.784730865 -24.763938738  307.452442 -22.589998  352.834521  -1.162850   255.06651304  354.4039092  -1.1344415
% 2022-Apr-25 18:00 *   328.819663790 -29.482902278  329.798917 -22.589587  352.834773  -1.162856   255.06273387  354.4051786  -1.1344641
% 2022-Apr-25 19:00 N   346.020412317 -32.351647084  352.145398 -22.589176  352.835026  -1.162862   255.05894084  354.4064509  -1.1344883
% 2022-Apr-25 20:00 N     3.864151157 -33.010204952   14.491884 -22.588764  352.835278  -1.162868   255.05513290  354.4077259  -1.1345139
% 2022-Apr-25 21:00 A    21.521342465 -31.367376302   36.838377 -22.588352  352.835531  -1.162874   255.05130981  354.4090027  -1.1345410
% 2022-Apr-25 22:00 A    38.255874803 -27.644315454   59.184877 -22.587941  352.835783  -1.162880   255.04747216  354.4102808  -1.1345690
% 2022-Apr-25 23:00 A    53.740265336 -22.273914882   81.531383 -22.587531  352.836036  -1.162886   255.04362135  354.4115591  -1.1345976
% 2022-Apr-26 00:00 A    68.061176897 -15.753743019  103.877896 -22.587122  352.836289  -1.162892   255.03975943  354.4128368  -1.1346265


AZ_H = [...
67.184076829; ...
80.715542464; ...
93.817773926; ...
106.935874763; ...
120.489838386; ...
134.827864526; ...
150.143782525; ...
166.364039828; ...
183.086014643; ...
199.689112436; ...
215.606732425; ...
230.555478783; ...
244.572707009; ...
257.921349742; ...
270.983227646; ...
284.191885896; ...
297.991809515; ...
312.784730865; ...
328.819663790; ...
346.020412317; ...
3.864151157; ...
21.521342465; ...
38.255874803; ...
53.740265336; ...
68.061176897];

EL_H = [...
-16.204018416; ...
-9.034889688; ...
-1.584320657; ...
5.753059807; ...
12.584011172; ...
18.492636799; ...
23.039992493; ...
25.808259877; ...
26.495767875; ...
25.020882425; ...
21.555365922; ...
16.456810067; ...
10.159457746; ...
3.096161316; ...
-4.327204323; ...
-11.720287695; ...
-18.680201461; ...
-24.763938738; ...
-29.482902278; ...
-32.351647084; ...
-33.010204952; ...
-31.367376302; ...
-27.644315454; ...
-22.273914882; ...
-15.753743019];

LT_H = [...
255.13067860; ...
255.12688270; ...
255.12308106; ...
255.11927684; ...
255.11547316; ...
255.11167288; ...
255.10787843; ...
255.10409160; ...
255.10031348; ...
255.09654433; ...
255.09278359; ...
255.08902990; ...
255.08528122; ...
255.08153494; ...
255.07778810; ...
255.07403753; ...
255.07028013; ...
255.06651304; ...
255.06273387; ...
255.05894084; ...
255.05513290; ...
255.05130981; ...
255.04747216; ...
255.04362135; ...
255.03975943];

au_meters = 1.495978707e11;
mu = 1.32712440018e20;

lat = 60.205490;
lon = 24.0206;

lat = 60.1984210;
lon = 24.7503;
alt = 51.788;

JTs = julian_time_ymdhms(2022, 4, 25, 0, 0, 0);
JTs = JTs:(1/24):(JTs + 1);
JTs = JTs - 0.08994 / 86400;

num_times = length(JTs);

AZ = [];
EL = [];

for ind_time = 1:num_times
    JT = JTs(ind_time);

    N = matrix_mod_tod(JT);

    r_ec_earth = vsop87_earth(JT);
    r_ec_neptune = vsop87_neptune(JT-LT_H(ind_time)*60/86400);
    [r_eq_earth, v_eq_earth] = coord_ecl_eq(JT, r_ec_earth, 0 * r_ec_earth);
    [r_eq_neptune, v_eq_neptune] = coord_ecl_eq(JT, r_ec_neptune, 0 * r_ec_neptune);

    r_j2000 = r_eq_neptune - r_eq_earth;
    r_j2000 = aberration_stellar_cart(JT, r_j2000, 0 * r_j2000);

    [r_mod, v_mod] = coord_j2000_mod(JT, r_j2000, 0 * r_j2000);
    [r_tod, v_tod] = coord_mod_tod(JT, r_mod, v_mod, N);
    [r_pef, v_pef] = coord_tod_pef(JT, r_tod, v_tod, N);
    [r_efi, v_efi] = coord_pef_efi(r_pef, v_pef, 0.1362/3600, 0.4693/3600);
    [slat, slon, sh] = coord_efi_wgs84(r_efi);
    [r_enu, v_enu] = coord_efi_enu(r_efi, v_efi, lat, lon, 0);
    [az, el] = coord_enu_azel(r_enu, v_enu);

    AZ = [AZ; az];
    EL = [EL; el];
end

figure(1);
clf;
subplot(2, 1, 1);
plot(0:24, 3600*min(mod(AZ - AZ_H, 360), mod(AZ_H - AZ, 360)), 'LineWidth', 2);
xlabel('Hour');
ylabel('Azimuth error (arcseconds)');
title('Error in the Position of the Neptune w.r.t. JPL Horizons - 25.04.2022');
grid on;
set(gca, 'xtick', 0:24);
xlim([0 24]);

subplot(2, 1, 2);
plot(0:24, 3600*mod(abs(EL - EL_H), 360), 'LineWidth', 2);
xlabel('Hour');
ylabel('Elevation error (arcseconds)');
grid on;
set(gca, 'xtick', 0:24);
xlim([0 24]);
