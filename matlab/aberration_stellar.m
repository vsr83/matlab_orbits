function [RA, decl] = aberration_stellar(JT, RA, decl, dv_j2000)
% MATRIX_MOD_TOD - Compute stellar aberration with the Ron-Vondrak expression.
%
% INPUTS:
%   JT         The Julian Time.
%   RA         Right-ascension (in degrees).
%   decl       Declination (in degrees).
%   dv_j2000   J2000 velocity to be added to the velocity of the center of the Earth
%              for example due to rotation and movement of the observer.
%
% OUTPUTS:
%   RA         Corrected right-ascension (in de.* sin(A)grees).
%   decl       Corrected declination (in degrees).
%
% References:
% [1] Meeus - Astronomical Algorithms 1998, Chapter 23

% Number of Julian centuries from J2000: 
T = (JT - 2451545.0)/36525.0

if nargin == 3
    dv_j2000 = [0; 0; 0];
end

L2 = 3.1761467 + 1021.3285546 * T;
L3 = 1.7534703 +  628.3075849 * T;
L4 = 6.2034809 +  334.0612431 * T;
L5 = 0.5995465 +   52.9690965 * T;
L6 = 0.8740168 +   21.3299095 * T;
L7 = 5.4812939 +    7.4781599 * T;
L8 = 5.3118863 +    3.8133036 * T;
Ld = 3.8103444 + 8399.6847337 * T;
D  = 5.1984667 + 7771.3771486 * T;
Md = 2.3555559 + 8328.6914289 * T;
F  = 1.6279052 + 8433.4661601 * T;

Acoeff = [...
0,  1, 0, 0, 0,0,0,0, 0, 0,0; ...
0,  2, 0, 0, 0,0,0,0, 0, 0,0; ...
0,  0, 0, 1, 0,0,0,0, 0, 0,0; ...
0,  0, 0, 0, 0,0,0,1, 0, 0,0; ...
0,  3, 0, 0, 0,0,0,0, 0, 0,0; ...
0,  0, 0, 0, 1,0,0,0, 0, 0,0; ...
0,  0, 0, 0, 0,0,0,0, 0, 0,1; ...
0,  0, 0, 0, 0,0,0,1, 0, 1,0; ...
0,  0, 0, 2, 0,0,0,0, 0, 0,0; ...
0,  2, 0,-1, 0,0,0,0, 0, 0,0; ...
0,  3,-8, 3, 0,0,0,0, 0, 0,0; ...
0,  5,-8, 3, 0,0,0,0, 0, 0,0; ...
2, -1, 0, 0, 0,0,0,0, 0, 0,0; ...
1,  0, 0, 0, 0,0,0,0, 0, 0,0; ...
0,  0, 0, 0, 0,1,0,0, 0, 0,0; ...
0,  1, 0,-2, 0,0,0,0, 0, 0,0; ...
0,  0, 0, 0, 0,0,1,0, 0, 0,0; ...
0,  1, 0, 1, 0,0,0,0, 0, 0,0; ...
2, -2, 0, 0, 0,0,0,0, 0, 0,0; ...
0,  1, 0,-1, 0,0,0,0, 0, 0,0; ...
0,  4, 0, 0, 0,0,0,0, 0, 0,0; ...
0,  3, 0,-2, 0,0,0,0, 0, 0,0; ...
1, -2, 0, 0, 0,0,0,0, 0, 0,0; ...
2, -3, 0, 0, 0,0,0,0, 0, 0,0; ...
0,  0, 0, 0, 2,0,0,0, 0, 0,0; ...
2, -4, 0, 0, 0,0,0,0, 0, 0,0; ...
0,  3,-2, 0, 0,0,0,0, 0, 0,0; ...
0,  0, 0, 0, 0,0,0,1, 2,-1,0; ...
8,-12, 0, 0, 0,0,0,0, 0, 0,0; ...
8,-14, 0, 0, 0,0,0,0, 0, 0,0; ...
0,  0, 2, 0, 0,0,0,0, 0, 0,0; ...
3, -4, 0, 0, 0,0,0,0, 0, 0,0; ...
0,  2, 0,-2, 0,0,0,0, 0, 0,0; ...
3, -3, 0, 0, 0,0,0,0, 0, 0,0; ...
0,  2,-2, 0, 0,0,0,0, 0, 0,0; ...
0,  0, 0, 0, 0,0,0,1,-2 ,0,0];

x_coeff = [...
-1719914,  -2, -25,   0;...
6434, 141, 28007, -107;...
715,   0,   0,   0;...
715,   0,   0,   0;...
486,  -5, -236,  -4;...
159,   0,   0,   0;...
  0,   0,   0,   0;...
 39,   0,   0,   0;...
 33,   0, -10,   0;...
 31,   0,   1,   0;...
  8,   0, -28,   0;...
  8,   0, -28,   0;...
 21,   0,   0,   0;...
-19,   0,   0,   0;...
 17,   0,   0,   0;...
 16,   0,   0,   0;...
 16,   0,   0,   0;...
 11,   0,  -1,   0;...
  0,   0, -11,   0;...
-11,   0,  -2,   0;...
 -7,   0,  -8,   0;...
-10,   0,   0,   0;...
 -9,   0,   0,   0;...
 -9,   0,   0,   0;...
  0,   0,  -9,   0;...
  0,   0,  -9,   0;...
  8,   0,   0,   0;...
  8,   0,   0,   0;...
 -4,   0,  -7,   0;...
 -4,   0,  -7,   0;...
 -6,   0,  -5,   0;...
 -1,   0,  -1,   0;...
  4,   0,  -6,   0;...
  0,   0,  -7,   0;...
  5,   0,  -5,   0;...
  5,   0,   0,   0];

y_coeff = [...
 25, -13, 1578089, 156;...
25697, -95, -5904, -130;...
  6,   0, -657,   0;...
  0,   0, -656,   0;...
-216,  -4, -446,   5;...
  2,   0, -147,   0;...
  0,   0,  26,   0;...
  0,   0, -36,   0;...
 -9,   0, -30,   0;...
  1,   0, -28,   0;...
 25,   0,   8,   0;...
-25,   0,  -8,   0;...
  0,   0, -19,   0;...
  0,   0,  17,   0;...
  0,   0, -16,   0;...
  0,   0,  15,   0;...
  1,   0, -15,   0;...
 -1,   0, -10,   0;...
-10,   0,   0,   0;...
 -2,   0,   9,   0;...
 -8,   0,   6,   0;...
  0,   0,   9,   0;...
  0,   0,  -9,   0;...
  0,   0,  -8,   0;...
 -8,   0,   0,   0;...
  8,   0,   0,   0;...
  0,   0,  -8,   0;...
  0,   0,  -7,   0;...
 -6,   0,   4,   0;...
  6,   0,  -4,   0;...
 -4,   0,   5,   0;...
 -2,   0,  -7,   0;...
 -5,   0,  -4,   0;...
 -6,   0,   0,   0;...
 -4,   0,  -5,   0;...
  0,   0,  -5,   0];

z_coeff = [...
 10,  32, 684185, -358; ...
11141, -48, -2559, -55; ...
-15,   0, -282,   0; ...
  0,   0, -285,   0; ...
-94,   0, -193,   0; ...
 -6,   0, -61,   0; ...
  0,   0, -59,   0; ...
  0,   0, -16,   0; ...
 -5,   0, -13,   0; ...
  0,   0, -12,   0; ...
 11,   0,   3,   0; ...
-11,   0,  -3,   0; ...
  0,   0,  -8,   0; ...
  0,   0,   8,   0; ...
  0,   0,  -7,   0; ...
  1,   0,   7,   0; ...
 -3,   0,  -6,   0; ...
 -1,   0,  -5,   0; ...
 -4,   0,   0,   0; ...
 -1,   0,   4,   0; ...
 -3,   0,   3,   0; ...
  0,   0,   4,   0; ...
  0,   0,  -4,   0; ...
  0,   0,  -4,   0; ...
 -3,   0,   0,   0; ...
  3,   0,   0,   0; ...
  0,   0,  -3,   0; ...
  0,   0,  -3,   0; ...
 -3,   0,   2,   0; ...
  3,   0,  -2,   0; ...
 -2,   0,   2,   0; ...
  1,   0,  -4,   0; ...
 -2,   0,  -2,   0; ...
 -3,   0,   0,   0; ...
 -2,   0,  -2,   0; ...
  0,   0,  -2,   0];

A = Acoeff * [L2, L3, L4, L5, L6, L7, L8, Ld, D, Md, F]';

% Velocity of the center of the Earth
v_x = (x_coeff(:, 1) + x_coeff(:, 2) * T) .* sin(A) + (x_coeff(:, 3) + x_coeff(:, 4) * T) .* cos(A);
v_y = (y_coeff(:, 1) + y_coeff(:, 2) * T) .* sin(A) + (y_coeff(:, 3) + y_coeff(:, 4) * T) .* cos(A);
v_z = (z_coeff(:, 1) + z_coeff(:, 2) * T) .* sin(A) + (z_coeff(:, 3) + z_coeff(:, 4) * T) .* cos(A);

au = 149597870700;
% From m/s to 10e-8 au/day;
factor = 86164.0905 * 1e8 / au;

dv_j2000 * factor
v_x = sum(v_x) + factor * dv_j2000(1);
v_y = sum(v_y) + factor * dv_j2000(2);
v_z = sum(v_z) + factor * dv_j2000(3);

% Velocity of light in au/day.
c = 17314463350;

delta_RA = (180/pi) * (v_y*cosd(RA) - v_x*sind(RA))/(c * cosd(decl));
delta_decl = - (180/pi) * ((v_x*cosd(RA) + v_y*sind(RA))*sind(decl) - v_z * cosd(decl)) / c;

RA = RA + delta_RA;
decl = decl + delta_decl;