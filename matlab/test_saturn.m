% JPL Horizons
%

%****************************************************************************************************************************************
% Date__(UT)__HR:MN     Azimuth__(a-app)__Elevation  ObsSub-LON ObsSub-LAT    hEcl-Lon   hEcl-Lat  1-way_down_LT     ObsEcLon    ObsEcLat
%****************************************************************************************************************************************
% 2022-Apr-25 00:00 A    98.316161280 -11.971621067   99.585731  15.558166  318.099282  -1.031736    84.65733330  323.9168067  -1.0047937
% 2022-Apr-25 01:00 N   111.105068751  -4.756839844  133.369433  15.556930  318.100578  -1.031787    84.65182298  323.9194489  -1.0049173
% 2022-Apr-25 02:00 C   124.085250775   1.855362165  167.153144  15.555695  318.101874  -1.031838    84.64631465  323.9220804  -1.0050383
% 2022-Apr-25 03:00 *m  137.552710475   7.503495369  200.936863  15.554461  318.103170  -1.031890    84.64081113  323.9247016  -1.0051561
% 2022-Apr-25 04:00 *m  151.657585058  11.828143064  234.720585  15.553227  318.104466  -1.031941    84.63531480  323.9273133  -1.0052703
% 2022-Apr-25 05:00 *m  166.356772413  14.504264972  268.504308  15.551992  318.105762  -1.031992    84.62982749  323.9299169  -1.0053811
% 2022-Apr-25 06:00 *m  181.401280318  15.301481301  302.288031  15.550757  318.107058  -1.032043    84.62435029  323.9325141  -1.0054885
% 2022-Apr-25 07:00 *m  196.408587321  14.146029204  336.071749  15.549520  318.108354  -1.032095    84.61888355  323.9351069  -1.0055931
% 2022-Apr-25 08:00 *m  211.011117630  11.144079767    9.855462  15.548282  318.109650  -1.032146    84.61342678  323.9376974  -1.0056954
% 2022-Apr-25 09:00 *m  224.995477490   6.548729555   43.639168  15.547043  318.110946  -1.032197    84.60797875  323.9402879  -1.0057963
% 2022-Apr-25 10:00 *m  238.357126879   0.695337013   77.422867  15.545803  318.112242  -1.032249    84.60253753  323.9428803  -1.0058967
% 2022-Apr-25 11:00 *   251.276919607  -6.054795746  111.206558  15.544561  318.113538  -1.032300    84.59710063  323.9454763  -1.0059974
% 2022-Apr-25 12:00 *   264.073044708 -13.340663090  144.990243  15.543319  318.114834  -1.032351    84.59166521  323.9480771  -1.0060995
% 2022-Apr-25 13:00 *   277.166425995 -20.797495874  178.773922  15.542078  318.116130  -1.032402    84.58622820  323.9506835  -1.0062036
% 2022-Apr-25 14:00 *   291.061683547 -28.030410307  212.557598  15.540837  318.117426  -1.032454    84.58078659  323.9532959  -1.0063106
% 2022-Apr-25 15:00 *   306.310302681 -34.575597585  246.341273  15.539598  318.118722  -1.032505    84.57533758  323.9559138  -1.0064208
% 2022-Apr-25 16:00 *   323.380557862 -39.869574780  280.124950  15.538361  318.120018  -1.032556    84.56987880  323.9585363  -1.0065346
% 2022-Apr-25 17:00 *   342.347115260 -43.278759132  313.908631  15.537127  318.121314  -1.032607    84.56440845  323.9611621  -1.0066519
% 2022-Apr-25 18:00 *     2.512317560 -44.263777182  347.692320  15.535896  318.122611  -1.032659    84.55892546  323.9637895  -1.0067726
% 2022-Apr-25 19:00 N    22.492565336 -42.643403483   21.476018  15.534670  318.123907  -1.032710    84.55342953  323.9664164  -1.0068962
% 2022-Apr-25 20:00 N    41.020123440 -38.709044391   55.259727  15.533447  318.125203  -1.032761    84.54792115  323.9690406  -1.0070221
% 2022-Apr-25 21:00 A    57.609960385 -33.046908717   89.043449  15.532227  318.126499  -1.032812    84.54240160  323.9716601  -1.0071494
% 2022-Apr-25 22:00 A    72.472751639 -26.282274400  122.827185  15.531012  318.127795  -1.032864    84.53687283  323.9742729  -1.0072774
% 2022-Apr-25 23:00 A    86.118452619 -18.953034514  156.610934  15.529800  318.129091  -1.032915    84.53133733  323.9768772  -1.0074049
% 2022-Apr-26 00:00 A    99.093790506 -11.502155480  190.394695  15.528591  318.130387  -1.032966    84.52579799  323.9794718  -1.0075312


AZ_H = [...
98.316161280; ...
111.105068751; ...
124.085250775; ...
137.552710475; ...
151.657585058; ...
166.356772413; ...
181.401280318; ...
196.408587321; ...
211.011117630; ...
224.995477490; ...
238.357126879; ...
251.276919607; ...
264.073044708; ...
277.166425995; ...
291.061683547; ...
306.310302681; ...
323.380557862; ...
342.347115260; ...
2.512317560; ...
22.492565336; ...
41.020123440; ...
57.609960385; ...
72.472751639; ...
86.118452619; ...
99.093790506];

EL_H = [...
-11.971621067; ...
-4.756839844; ...
1.855362165; ...
7.503495369; ...
11.828143064; ...
14.504264972; ...
15.301481301; ...
14.146029204; ...
11.144079767; ...
6.548729555; ...
0.695337013; ...
-6.054795746; ...
-13.340663090; ...
-20.797495874; ...
-28.030410307; ...
-34.575597585; ...
-39.869574780; ...
-43.278759132; ...
-44.263777182; ...
-42.643403483; ...
-38.709044391; ...
-33.046908717; ...
-26.282274400; ...
-18.953034514; ...
-11.502155480];

LT_H = [...
84.65733330; ...
84.65182298; ...
84.64631465; ...
84.64081113; ...
84.63531480; ...
84.62982749; ...
84.62435029; ...
84.61888355; ...
84.61342678; ...
84.60797875; ...
84.60253753; ...
84.59710063; ...
84.59166521; ...
84.58622820; ...
84.58078659; ...
84.57533758; ...
84.56987880; ...
84.56440845; ...
84.55892546; ...
84.55342953; ...
84.54792115; ...
84.54240160; ...
84.53687283; ...
84.53133733; ...
84.52579799];

au_meters = 1.495978707e11;
mu = 1.32712440018e20;

lat = 60.205490;
lon = 24.0206;

lat = 60.1984210;
lon = 24.7503;
alt = 51.788;

JTs = julian_time_ymdhms(2022, 4, 25, 0, 0, 0);
JTs = JTs:(1/24):(JTs + 1);
JTs = JTs - 0.08994 / 86400;

num_times = length(JTs);

AZ = [];
EL = [];

for ind_time = 1:num_times
    JT = JTs(ind_time);

    N = matrix_mod_tod(JT);

    r_ec_earth = vsop87_earth(JT);
    r_ec_saturn = vsop87_saturn(JT-LT_H(ind_time)*60/86400);
    [r_eq_earth, v_eq_earth] = coord_ecl_eq(JT, r_ec_earth, 0 * r_ec_earth);
    [r_eq_saturn, v_eq_saturn] = coord_ecl_eq(JT, r_ec_saturn, 0 * r_ec_saturn);

    r_j2000 = r_eq_saturn - r_eq_earth;
    r_j2000 = aberration_stellar_cart(JT, r_j2000, 0 * r_j2000);

    [r_mod, v_mod] = coord_j2000_mod(JT, r_j2000, 0 * r_j2000);
    [r_tod, v_tod] = coord_mod_tod(JT, r_mod, v_mod, N);
    [r_pef, v_pef] = coord_tod_pef(JT, r_tod, v_tod, N);
    [r_efi, v_efi] = coord_pef_efi(r_pef, v_pef, 0.1362/3600, 0.4693/3600);
    [slat, slon, sh] = coord_efi_wgs84(r_efi);
    [r_enu, v_enu] = coord_efi_enu(r_efi, v_efi, lat, lon, 0);
    [az, el] = coord_enu_azel(r_enu, v_enu);

    AZ = [AZ; az];
    EL = [EL; el];
end

figure(1);
clf;
subplot(2, 1, 1);
plot(0:24, 3600*min(mod(AZ - AZ_H, 360), mod(AZ_H - AZ, 360)), 'LineWidth', 2);
xlabel('Hour');
ylabel('Azimuth error (arcseconds)');
title('Error in the Position of the saturn w.r.t. JPL Horizons - 25.04.2022');
grid on;
set(gca, 'xtick', 0:24);
xlim([0 24]);

subplot(2, 1, 2);
plot(0:24, 3600*mod(abs(EL - EL_H), 360), 'LineWidth', 2);
xlabel('Hour');
ylabel('Elevation error (arcseconds)');
grid on;
set(gca, 'xtick', 0:24);
xlim([0 24]);
