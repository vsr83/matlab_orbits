% JPL Horizons
%

%****************************************************************************************************************************************
% Date__(UT)__HR:MN     Azimuth__(a-app)__Elevation  ObsSub-LON ObsSub-LAT    hEcl-Lon   hEcl-Lat  1-way_down_LT     ObsEcLon    ObsEcLat
%****************************************************************************************************************************************
% 2022-Apr-25 00:00 A    64.751527422 -16.273858140  351.866457   2.013830  349.248480  -1.214813    47.61332358  356.7179839  -1.0556303
% 2022-Apr-25 01:00 N    78.347070239  -9.197837034   28.131838   2.014331  349.252268  -1.214844    47.60998937  356.7269730  -1.0557432
% 2022-Apr-25 02:00 C    91.472134206  -1.769029972   64.397236   2.014825  349.256056  -1.214875    47.60664972  356.7359480  -1.0558511
% 2022-Apr-25 03:00 *m  104.568626426   5.616390554  100.662650   2.015312  349.259844  -1.214906    47.60330777  356.7449076  -1.0559533
% 2022-Apr-25 04:00 *m  118.064499630  12.565903006  136.928079   2.015791  349.263632  -1.214938    47.59996666  356.7538517  -1.0560497
% 2022-Apr-25 05:00 *m  132.328978370  18.664433647  173.193518   2.016264  349.267420  -1.214969    47.59662930  356.7627811  -1.0561404
% 2022-Apr-25 06:00 *m  147.592869719  23.468541634  209.458965   2.016732  349.271208  -1.215000    47.59329818  356.7716973  -1.0562258
% 2022-Apr-25 07:00 *m  163.829764963  26.543274444  245.724415   2.017196  349.274996  -1.215031    47.58997521  356.7806027  -1.0563071
% 2022-Apr-25 08:00 *m  180.670580045  27.553993425  281.989864   2.017657  349.278784  -1.215062    47.58666158  356.7895005  -1.0563853
% 2022-Apr-25 09:00 *m  197.485697348  26.378919479  318.255309   2.018118  349.282572  -1.215094    47.58335767  356.7983938  -1.0564619
% 2022-Apr-25 10:00 *m  213.657500388  23.159494758  354.520746   2.018579  349.286359  -1.215125    47.58006305  356.8072864  -1.0565384
% 2022-Apr-25 11:00 *   228.843170574  18.242453202   30.786173   2.019045  349.290147  -1.215156    47.57677647  356.8161816  -1.0566164
% 2022-Apr-25 12:00 *   243.040309933  12.066225116   67.051589   2.019514  349.293935  -1.215187    47.57349599  356.8250828  -1.0566973
% 2022-Apr-25 13:00 *   256.494261990   5.072944956  103.316994   2.019990  349.297722  -1.215218    47.57021907  356.8339924  -1.0567824
% 2022-Apr-25 14:00 *   269.580917821  -2.324353660  139.582387   2.020473  349.301510  -1.215250    47.56694280  356.8429125  -1.0568726
% 2022-Apr-25 15:00 *   282.730412827  -9.733607281  175.847770   2.020962  349.305298  -1.215281    47.56366402  356.8518440  -1.0569686
% 2022-Apr-25 16:00 *   296.383528905 -16.756778246  212.113146   2.021459  349.309085  -1.215312    47.56037963  356.8607873  -1.0570706
% 2022-Apr-25 17:00 *   310.943012474 -22.961806703  248.378518   2.021962  349.312873  -1.215343    47.55708671  356.8697414  -1.0571784
% 2022-Apr-25 18:00 *   326.677508276 -27.873389776  284.643889   2.022471  349.316660  -1.215374    47.55378280  356.8787048  -1.0572915
% 2022-Apr-25 19:00 N   343.565167401 -31.011744601  320.909264   2.022983  349.320448  -1.215406    47.55046602  356.8876750  -1.0574089
% 2022-Apr-25 20:00 N     1.165326927 -32.000906845  357.174647   2.023498  349.324235  -1.215437    47.54713519  356.8966490  -1.0575294
% 2022-Apr-25 21:00 A    18.709978242 -30.708129971   33.440040   2.024013  349.328023  -1.215468    47.54378997  356.9056234  -1.0576516
% 2022-Apr-25 22:00 A    35.458368600 -27.304897382   69.705448   2.024527  349.331810  -1.215499    47.54043082  356.9145946  -1.0577740
% 2022-Apr-25 23:00 A    51.027272848 -22.189163631  105.970872   2.025037  349.335598  -1.215530    47.53705901  356.9235592  -1.0578949
% 2022-Apr-26 00:00 A    65.443529435 -15.844636368  142.236314   2.025543  349.339385  -1.215561    47.53367651  356.9325141  -1.0580131


AZ_H = [...
64.751527422; ...
78.347070239; ...
91.472134206; ...
104.568626426; ...
118.064499630; ...
132.328978370; ...
147.592869719; ...
163.829764963; ...
180.670580045; ...
197.485697348; ...
213.657500388; ...
228.843170574; ...
243.040309933; ...
256.494261990; ...
269.580917821; ...
282.730412827; ...
296.383528905; ...
310.943012474; ...
326.677508276; ...
343.565167401; ...
1.165326927; ...
18.709978242; ...
35.458368600; ...
51.027272848; ...
65.443529435];

EL_H = [...
-16.273858140; ...
-9.197837034; ...
-1.769029972; ...
5.616390554; ...
12.565903006; ...
18.664433647; ...
23.468541634; ...
26.543274444; ...
27.553993425; ...
26.378919479; ...
23.159494758; ...
18.242453202; ...
12.066225116; ...
5.072944956; ...
-2.324353660; ...
-9.733607281; ...
-16.756778246; ...
-22.961806703; ...
-27.873389776; ...
-31.011744601; ...
-32.000906845; ...
-30.708129971; ...
-27.304897382; ...
-22.189163631; ...
-15.844636368];

au_meters = 1.495978707e11;
mu = 1.32712440018e20;

lat = 60.205490;
lon = 24.0206;

lat = 60.1984210;
lon = 24.7503;
alt = 51.788;

JTs = julian_time_ymdhms(2022, 4, 25, 0, 0, 0);
JTs = JTs:(1/24):(JTs + 1);
JTs = JTs - 0.08994 / 86400;

num_times = length(JTs);

AZ = [];
EL = [];

for ind_time = 1:num_times
    JT = JTs(ind_time);

    N = matrix_mod_tod(JT);

    r_ec_earth = vsop87_earth(JT);
    r_ec_jupiter = vsop87_jupiter(JT-2850/86400);
    [r_eq_earth, v_eq_earth] = coord_ecl_eq(JT, r_ec_earth, 0 * r_ec_earth);
    [r_eq_jupiter, v_eq_jupiter] = coord_ecl_eq(JT, r_ec_jupiter, 0 * r_ec_jupiter);

    r_j2000 = r_eq_jupiter - r_eq_earth;
    r_j2000 = aberration_stellar_cart(JT, r_j2000, 0 * r_j2000);

    [r_mod, v_mod] = coord_j2000_mod(JT, r_j2000, 0 * r_j2000);
    [r_tod, v_tod] = coord_mod_tod(JT, r_mod, v_mod, N);
    [r_pef, v_pef] = coord_tod_pef(JT, r_tod, v_tod, N);
    [r_efi, v_efi] = coord_pef_efi(r_pef, v_pef, 0.1362/3600, 0.4693/3600);
    [slat, slon, sh] = coord_efi_wgs84(r_efi);
    [r_enu, v_enu] = coord_efi_enu(r_efi, v_efi, lat, lon, 0);
    [az, el] = coord_enu_azel(r_enu, v_enu);

    AZ = [AZ; az];
    EL = [EL; el];
end

figure(1);
clf;
subplot(2, 1, 1);
plot(0:24, 3600*min(mod(AZ - AZ_H, 360), mod(AZ_H - AZ, 360)), 'LineWidth', 2);
xlabel('Hour');
ylabel('Azimuth error (arcseconds)');
title('Error in the Position of the Jupiter w.r.t. JPL Horizons - 25.04.2022');
grid on;
set(gca, 'xtick', 0:24);
xlim([0 24]);

subplot(2, 1, 2);
plot(0:24, 3600*mod(abs(EL - EL_H), 360), 'LineWidth', 2);
xlabel('Hour');
ylabel('Elevation error (arcseconds)');
grid on;
set(gca, 'xtick', 0:24);
xlim([0 24]);
