% JPL Horizons
%

%****************************************************************************************************************************************
% Date__(UT)__HR:MN     Azimuth__(a-app)__Elevation  ObsSub-LON ObsSub-LAT    hEcl-Lon   hEcl-Lat  1-way_down_LT     ObsEcLon    ObsEcLat
%****************************************************************************************************************************************
% 2022-Apr-25 00:00 A     5.931121592  -8.347866262   90.741658  -1.735676  142.752425   6.982711     7.95327257   54.4561676   2.4849015
% 2022-Apr-25 01:00 N    19.906127495  -6.667228537   90.942196  -1.732382  142.968539   6.980632     7.94477484   54.5114781   2.4883652
% 2022-Apr-25 02:00 C    33.503460391  -3.307286853   91.142889  -1.729119  143.184373   6.978458     7.93626905   54.5666345   2.4918397
% 2022-Apr-25 03:00 *m   46.609169882   1.495044820   91.343756  -1.725890  143.399926   6.976189     7.92775667   54.6216161   2.4953264
% 2022-Apr-25 04:00 *m   59.273004282   7.443915662   91.544815  -1.722696  143.615199   6.973825     7.91923976   54.6764047   2.4988242
% 2022-Apr-25 05:00 *m   71.695553159  14.222061882   91.746081  -1.719535  143.830192   6.971367     7.91072090   54.7309862   2.5023297
% 2022-Apr-25 06:00 *m   84.207676267  21.504963735   91.947562  -1.716403  144.044904   6.968815     7.90220293   54.7853513   2.5058369
% 2022-Apr-25 07:00 *m   97.265070974  28.950370091   92.149262  -1.713290  144.259335   6.966170     7.89368885   54.8394965   2.5093380
% 2022-Apr-25 08:00 *m  111.455848283  36.165375334   92.351180  -1.710189  144.473486   6.963431     7.88518153   54.8934235   2.5128240
% 2022-Apr-25 09:00 *m  127.477150794  42.655139382   92.553309  -1.707087  144.687357   6.960600     7.87668360   54.9471403   2.5162849
% 2022-Apr-25 10:00 *m  145.952119747  47.775772284   92.755635  -1.703974  144.900947   6.957677     7.86819722   55.0006596   2.5197109
% 2022-Apr-25 11:00 *   166.899804576  50.774836570   92.958144  -1.700839  145.114257   6.954662     7.85972397   55.0539985   2.5230927
% 2022-Apr-25 12:00 *   189.089163152  51.052447020   93.160815  -1.697670  145.327287   6.951556     7.85126472   55.1071772   2.5264221
% 2022-Apr-25 13:00 *   210.413050806  48.546995786   93.363628  -1.694460  145.540036   6.948359     7.84281959   55.1602176   2.5296928
% 2022-Apr-25 14:00 *   229.393453561  43.783884911   93.566561  -1.691201  145.752505   6.945071     7.83438796   55.2131417   2.5329008
% 2022-Apr-25 15:00 *   245.848792343  37.515920342   93.769594  -1.687891  145.964693   6.941694     7.82596847   55.2659705   2.5360446
% 2022-Apr-25 16:00 *   260.339799484  30.416867506   93.972710  -1.684529  146.176602   6.938226     7.81755918   55.3187219   2.5391252
% 2022-Apr-25 17:00 *   273.571336238  23.008174359   94.175894  -1.681116  146.388230   6.934670     7.80915764   55.3714101   2.5421463
% 2022-Apr-25 18:00 *   286.155499985  15.698520431   94.379137  -1.677659  146.599579   6.931024     7.80076113   55.4240442   2.5451137
% 2022-Apr-25 19:00 N   298.570883810   8.837083412   94.582437  -1.674163  146.810648   6.927290     7.79236677   55.4766279   2.5480352
% 2022-Apr-25 20:00 N   311.169285642   2.750195681   94.785793  -1.670640  147.021437   6.923468     7.78397179   55.5291587   2.5509202
% 2022-Apr-25 21:00 A   324.173914711  -2.244115945   94.989215  -1.667101  147.231946   6.919559     7.77557369   55.5816287   2.5537785
% 2022-Apr-25 22:00 A   337.661333755  -5.845838687   95.192715  -1.663555  147.442176   6.915562     7.76717041   55.6340246   2.5566200
% 2022-Apr-25 23:00 A   351.546048618  -7.806546029   95.396309  -1.660016  147.652126   6.911478     7.75876048   55.6863288   2.5594541
% 2022-Apr-26 00:00 A     5.601244029  -7.976472567   95.600017  -1.656493  147.861797   6.907308     7.75034313   55.7385207   2.5622888


AZ_H = [...
5.931121592; ...
19.906127495; ...
33.503460391; ...
46.609169882; ...
59.273004282; ...
71.695553159; ...
84.207676267; ...
97.265070974; ...
111.455848283; ...
127.477150794; ...
145.952119747; ...
166.899804576; ...
189.089163152; ...
210.413050806; ...
229.393453561; ...
245.848792343; ...
260.339799484; ...
273.571336238; ...
286.155499985; ...
298.570883810; ...
311.169285642; ...
324.173914711; ...
337.661333755; ...
351.546048618; ...
5.601244029];

EL_H = [...
-8.347866262; ...
-6.667228537; ...
-3.307286853; ...
1.495044820; ...
7.443915662; ...
14.222061882; ...
21.504963735; ...
28.950370091; ...
36.165375334; ...
42.655139382; ...
47.775772284; ...
50.774836570; ...
51.052447020; ...
48.546995786; ...
43.783884911; ...
37.515920342; ...
30.416867506; ...
23.008174359; ...
15.698520431; ...
8.837083412; ...
2.750195681; ...
-2.244115945; ...
-5.845838687; ...
-7.806546029; ...
-7.976472567];

au_meters = 1.495978707e11;
mu = 1.32712440018e20;

lat = 60.205490;
lon = 24.0206;

lat = 60.1984210;
lon = 24.7503;
alt = 51.788;

JTs = julian_time_ymdhms(2022, 4, 25, 0, 0, 0);
JTs = JTs:(1/24):(JTs + 1);
JTs = JTs - 0.08994 / 86400;

num_times = length(JTs);

AZ = [];
EL = [];

for ind_time = 1:num_times
    JT = JTs(ind_time);

    N = matrix_mod_tod(JT);

    r_ec_earth = vsop87_earth(JT);
    r_ec_mercury = vsop87_mercury(JT - 7.8*60/86400);
    [r_eq_earth, v_eq_earth]     = coord_ecl_eq(JT, r_ec_earth, 0 * r_ec_earth);
    [r_eq_mercury, v_eq_mercury] = coord_ecl_eq(JT, r_ec_mercury, 0 * r_ec_mercury);

    r_j2000 = r_eq_mercury - r_eq_earth;
    r_j2000 = aberration_stellar_cart(JT, r_j2000, 0 * r_j2000);

    [r_mod, v_mod] = coord_j2000_mod(JT, r_j2000, 0 * r_j2000);
    [r_tod, v_tod] = coord_mod_tod(JT, r_mod, v_mod, N);
    [r_pef, v_pef] = coord_tod_pef(JT, r_tod, v_tod, N);
    [r_efi, v_efi] = coord_pef_efi(r_pef, v_pef, 0.1362/3600, 0.4693/3600);
    [slat, slon, sh] = coord_efi_wgs84(r_efi);
    [r_enu, v_enu] = coord_efi_enu(r_efi, v_efi, lat, lon, 0);
    [az, el] = coord_enu_azel(r_enu, v_enu);

    AZ = [AZ; az];
    EL = [EL; el];
end

figure(1);
clf;
subplot(2, 1, 1);
plot(0:24, 3600*min(mod(AZ - AZ_H, 360), mod(AZ_H - AZ, 360)), 'LineWidth', 2);
xlabel('Hour');
ylabel('Azimuth error (arcseconds)');
title('Error in the Position of the Mercury w.r.t. JPL Horizons - 25.04.2022');
grid on;
set(gca, 'xtick', 0:24);
xlim([0 24]);

subplot(2, 1, 2);
plot(0:24, 3600*mod(abs(EL - EL_H), 360), 'LineWidth', 2);
xlabel('Hour');
ylabel('Elevation error (arcseconds)');
grid on;
set(gca, 'xtick', 0:24);
xlim([0 24]);
