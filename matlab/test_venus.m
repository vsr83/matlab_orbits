% JPL Horizons
%

%****************************************************************************************************************************************
% Date__(UT)__HR:MN     Azimuth__(a-app)__Elevation  ObsSub-LON ObsSub-LAT    hEcl-Lon   hEcl-Lat  1-way_down_LT     ObsEcLon    ObsEcLat
%****************************************************************************************************************************************
% 2022-Apr-25 00:00 A    70.360593455 -15.824390465  200.681956   0.027371  278.915181  -1.289161     7.93212821  351.3085682  -0.9879636
% 2022-Apr-25 01:00 N    83.744959802  -8.561375148  200.790670   0.029225  278.981096  -1.292776     7.93470812  351.3555500  -0.9904612
% 2022-Apr-25 02:00 C    96.765964065  -1.109968732  200.899308   0.031045  279.047011  -1.296389     7.93728577  351.4024566  -0.9929232
% 2022-Apr-25 03:00 *m  109.865466678   6.142272808  201.007870   0.032830  279.112925  -1.300000     7.93986428  351.4492873  -0.9953476
% 2022-Apr-25 04:00 *m  123.447819323  12.805745740  201.116362   0.034578  279.178839  -1.303609     7.94244671  351.4960468  -0.9977345
% 2022-Apr-25 05:00 *m  137.831364802  18.468313943  201.224793   0.036294  279.244752  -1.307217     7.94503583  351.5427447  -1.0000864
% 2022-Apr-25 06:00 *m  153.164055069  22.701732166  201.333178   0.037981  279.310665  -1.310822     7.94763393  351.5893952  -1.0024081
% 2022-Apr-25 07:00 *m  169.320109929  25.113440872  201.441536   0.039647  279.376578  -1.314427     7.95024269  351.6360160  -1.0047063
% 2022-Apr-25 08:00 *m  185.866560252  25.442675359  201.549887   0.041299  279.442490  -1.318029     7.95286303  351.6826268  -1.0069888
% 2022-Apr-25 09:00 *m  202.201539465  23.652170811  201.658251   0.042946  279.508402  -1.321629     7.95549507  351.7292486  -1.0092646
% 2022-Apr-25 10:00 *m  217.817624561  19.943299123  201.766648   0.044596  279.574314  -1.325228     7.95813812  351.7759014  -1.0115428
% 2022-Apr-25 11:00 *   232.492936444  14.681034476  201.875098   0.046259  279.640225  -1.328825     7.96079072  351.8226038  -1.0138322
% 2022-Apr-25 12:00 *   246.302601927   8.291746088  201.983614   0.047942  279.706136  -1.332420     7.96345073  351.8693709  -1.0161405
% 2022-Apr-25 13:00 *   259.523993521   1.196119012  202.092207   0.049650  279.772047  -1.336014     7.96611551  351.9162138  -1.0184741
% 2022-Apr-25 14:00 *   272.541473273  -6.209285393  202.200883   0.051387  279.837957  -1.339605     7.96878207  351.9631386  -1.0208372
% 2022-Apr-25 15:00 *   285.787929969 -13.537698474  202.309642   0.053157  279.903867  -1.343195     7.97144727  352.0101461  -1.0232321
% 2022-Apr-25 16:00 *   299.705818001 -20.383630907  202.418478   0.054956  279.969777  -1.346783     7.97410806  352.0572318  -1.0256585
% 2022-Apr-25 17:00 *   314.687520500 -26.296746772  202.527381   0.056784  280.035686  -1.350369     7.97676166  352.1043858  -1.0281137
% 2022-Apr-25 18:00 *   330.952275456 -30.781394118  202.636337   0.058636  280.101595  -1.353954     7.97940578  352.1515943  -1.0305930
% 2022-Apr-25 19:00 N   348.363516635 -33.355680309  202.745327   0.060504  280.167503  -1.357536     7.98203875  352.1988395  -1.0330899
% 2022-Apr-25 20:00 N     6.325096051 -33.684667629  202.854332   0.062380  280.233411  -1.361117     7.98465964  352.2461018  -1.0355962
% 2022-Apr-25 21:00 A    23.971133811 -31.720808847  202.963330   0.064257  280.299319  -1.364696     7.98726832  352.2933605  -1.0381032
% 2022-Apr-25 22:00 A    40.593317036 -27.726895336  203.072302   0.066126  280.365227  -1.368273     7.98986548  352.3405953  -1.0406017
% 2022-Apr-25 23:00 A    55.924569324 -22.157698619  203.181229   0.067977  280.431134  -1.371848     7.99245259  352.3877881  -1.0430830
% 2022-Apr-26 00:00 A    70.101575622 -15.513307331  203.290096   0.069804  280.497041  -1.375421     7.99503177  352.4349234  -1.0455395


AZ_H = [...
70.360593455; ...
83.744959802; ...
96.765964065; ...
109.865466678; ...
123.447819323; ...
137.831364802; ...
153.164055069; ...
169.320109929; ...
185.866560252; ...
202.201539465; ...
217.817624561; ...
232.492936444; ...
246.302601927; ...
259.523993521; ...
272.541473273; ...
285.787929969; ...
299.705818001; ...
314.687520500; ...
330.952275456; ...
348.363516635; ...
6.325096051; ...
23.971133811; ...
40.593317036; ...
55.924569324; ...
70.101575622];

EL_H = [...
-15.824390465; ...
-8.561375148; ...
-1.109968732; ...
6.142272808; ...
12.805745740; ...
18.468313943; ...
22.701732166; ...
25.113440872; ...
25.442675359; ...
23.652170811; ...
19.943299123; ...
14.681034476; ...
8.291746088; ...
1.196119012; ...
-6.209285393; ...
-13.537698474; ...
-20.383630907; ...
-26.296746772; ...
-30.781394118; ...
-33.355680309; ...
-33.684667629; ...
-31.720808847; ...
-27.726895336; ...
-22.157698619; ...
-15.513307331];

au_meters = 1.495978707e11;
mu = 1.32712440018e20;

lat = 60.205490;
lon = 24.0206;

lat = 60.1984210;
lon = 24.7503;
alt = 51.788;

JTs = julian_time_ymdhms(2022, 4, 25, 0, 0, 0);
JTs = JTs:(1/24):(JTs + 1);
JTs = JTs - 0.08994 / 86400;

num_times = length(JTs);

AZ = [];
EL = [];

for ind_time = 1:num_times
    JT = JTs(ind_time);

    N = matrix_mod_tod(JT);

    r_ec_earth = vsop87_earth(JT);
    r_ec_venus = vsop87_venus(JT - 480/86400);
    [r_eq_earth, v_eq_earth] = coord_ecl_eq(JT, r_ec_earth, 0 * r_ec_earth);
    [r_eq_venus, v_eq_venus] = coord_ecl_eq(JT, r_ec_venus, 0 * r_ec_venus);

    r_j2000 = r_eq_venus - r_eq_earth;
    r_j2000 = aberration_stellar_cart(JT, r_j2000, 0 * r_j2000);

    [r_mod, v_mod] = coord_j2000_mod(JT, r_j2000, 0 * r_j2000);
    [r_tod, v_tod] = coord_mod_tod(JT, r_mod, v_mod, N);
    [r_pef, v_pef] = coord_tod_pef(JT, r_tod, v_tod, N);
    [r_efi, v_efi] = coord_pef_efi(r_pef, v_pef, 0.1362/3600, 0.4693/3600);
    [slat, slon, sh] = coord_efi_wgs84(r_efi);
    [r_enu, v_enu] = coord_efi_enu(r_efi, v_efi, lat, lon, 0);
    [az, el] = coord_enu_azel(r_enu, v_enu);

    AZ = [AZ; az];
    EL = [EL; el];
end

figure(1);
clf;
subplot(2, 1, 1);
plot(0:24, 3600*min(mod(AZ - AZ_H, 360), mod(AZ_H - AZ, 360)), 'LineWidth', 2);
xlabel('Hour');
ylabel('Azimuth error (arcseconds)');
title('Error in the Position of the Venus w.r.t. JPL Horizons - 25.04.2022');
grid on;
set(gca, 'xtick', 0:24);
xlim([0 24]);

subplot(2, 1, 2);
plot(0:24, 3600*mod(abs(EL - EL_H), 360), 'LineWidth', 2);
xlabel('Hour');
ylabel('Elevation error (arcseconds)');
grid on;
set(gca, 'xtick', 0:24);
xlim([0 24]);
