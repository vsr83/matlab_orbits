% JPL Horizons
%

%****************************************************************************************************************************************
% Date__(UT)__HR:MN     Azimuth__(a-app)__Elevation  ObsSub-LON ObsSub-LAT    hEcl-Lon   hEcl-Lat  1-way_down_LT     ObsEcLon    ObsEcLat
%****************************************************************************************************************************************
% 2022-Apr-25 00:00 A    15.685900417 -12.970624790  286.545286  56.796134   44.377983  -0.381889   172.14158017   44.2012906  -0.3616032
% 2022-Apr-25 01:00 N    30.155667463 -10.061637368  307.427590  56.798425   44.378446  -0.381884   172.14256390   44.2036910  -0.3616025
% 2022-Apr-25 02:00 C    44.040839578  -5.558242364  328.309901  56.800714   44.378910  -0.381879   172.14353376   44.2060925  -0.3616007
% 2022-Apr-25 03:00 *m   57.329661227   0.215797664  349.192218  56.803001   44.379374  -0.381873   172.14449163   44.2084938  -0.3615974
% 2022-Apr-25 04:00 *m   70.192133501   6.907815492   10.074540  56.805284   44.379837  -0.381868   172.14543997   44.2108938  -0.3615923
% 2022-Apr-25 05:00 *m   82.937381900  14.162940911   30.956865  56.807564   44.380301  -0.381862   172.14638161   44.2132912  -0.3615852
% 2022-Apr-25 06:00 *m   95.982613267  21.621254371   51.839192  56.809840   44.380765  -0.381857   172.14731958   44.2156851  -0.3615762
% 2022-Apr-25 07:00 *m  109.837796206  28.892060919   72.721520  56.812112   44.381228  -0.381851   172.14825690   44.2180748  -0.3615653
% 2022-Apr-25 08:00 *m  125.074654599  35.513854587   93.603847  56.814381   44.381692  -0.381846   172.14919635   44.2204600  -0.3615528
% 2022-Apr-25 09:00 *m  142.201780637  40.919005464  114.486171  56.816647   44.382155  -0.381841   172.15014032   44.2228405  -0.3615390
% 2022-Apr-25 10:00 *m  161.342280611  44.456044715  135.368491  56.818912   44.382619  -0.381835   172.15109061   44.2252167  -0.3615244
% 2022-Apr-25 11:00 *   181.804885673  45.553451980  156.250808  56.821176   44.383083  -0.381830   172.15204832   44.2275891  -0.3615095
% 2022-Apr-25 12:00 *   202.128101706  44.002618651  177.133120  56.823440   44.383546  -0.381824   172.15301379   44.2299585  -0.3614948
% 2022-Apr-25 13:00 *   220.940520426  40.093774572  198.015427  56.825705   44.384010  -0.381819   172.15398654   44.2323260  -0.3614808
% 2022-Apr-25 14:00 *   237.713001096  34.431618511  218.897731  56.827973   44.384474  -0.381814   172.15496535   44.2346928  -0.3614679
% 2022-Apr-25 15:00 *   252.668241326  27.659922081  239.780032  56.830243   44.384937  -0.381808   172.15594828   44.2370601  -0.3614566
% 2022-Apr-25 16:00 *   266.342482278  20.326809688  260.662331  56.832517   44.385401  -0.381803   172.15693289   44.2394293  -0.3614471
% 2022-Apr-25 17:00 *   279.301587748  12.878397398  281.544630  56.834795   44.385865  -0.381797   172.15791633   44.2418014  -0.3614396
% 2022-Apr-25 18:00 *   292.040382238   5.697434909  302.426930  56.837077   44.386328  -0.381792   172.15889556   44.2441773  -0.3614341
% 2022-Apr-25 19:00 N   304.958477261  -0.858326672  323.309233  56.839363   44.386792  -0.381787   172.15986757   44.2465579  -0.3614304
% 2022-Apr-25 20:00 N   318.343388405  -6.433866072  344.191540  56.841653   44.387256  -0.381781   172.16082959   44.2489433  -0.3614283
% 2022-Apr-25 21:00 A   332.336235980 -10.678821348    5.073852  56.843946   44.387719  -0.381776   172.16177924   44.2513337  -0.3614275
% 2022-Apr-25 22:00 A   346.890150568 -13.279617646   25.956172  56.846240   44.388183  -0.381770   172.16271474   44.2537288  -0.3614275
% 2022-Apr-25 23:00 A     1.763240423 -14.017302119   46.838498  56.848536   44.388646  -0.381765   172.16363501   44.2561281  -0.3614278
% 2022-Apr-26 00:00 A    16.590973067 -12.825356264   67.720832  56.850832   44.389110  -0.381760   172.16453974   44.2585307  -0.3614280


AZ_H = [...
15.685900417; ...
30.155667463; ...
44.040839578; ...
57.329661227; ...
70.192133501; ...
82.937381900; ...
95.982613267; ...
109.837796206; ...
125.074654599; ...
142.201780637; ...
161.342280611; ...
181.804885673; ...
202.128101706; ...
220.940520426; ...
237.713001096; ...
252.668241326; ...
266.342482278; ...
279.301587748; ...
292.040382238; ...
304.958477261; ...
318.343388405; ...
332.336235980; ...
346.890150568; ...
1.763240423; ...
16.590973067];

EL_H = [...
-12.970624790; ...
-10.061637368; ...
-5.558242364; ...
0.215797664; ...
6.907815492; ...
14.162940911; ...
21.621254371; ...
28.892060919; ...
35.513854587; ...
40.919005464; ...
44.456044715; ...
45.553451980; ...
44.002618651; ...
40.093774572; ...
34.431618511; ...
27.659922081; ...
20.326809688; ...
12.878397398; ...
5.697434909; ...
-0.858326672; ...
-6.433866072; ...
-10.678821348; ...
-13.279617646; ...
-14.017302119; ...
-12.825356264];

LT_H = [...
172.14158017; ...
172.14256390; ...
172.14353376; ...
172.14449163; ...
172.14543997; ...
172.14638161; ...
172.14731958; ...
172.14825690; ...
172.14919635; ...
172.15014032; ...
172.15109061; ...
172.15204832; ...
172.15301379; ...
172.15398654; ...
172.15496535; ...
172.15594828; ...
172.15693289; ...
172.15791633; ...
172.15889556; ...
172.15986757; ...
172.16082959; ...
172.16177924; ...
172.16271474; ...
172.16363501; ...
172.16453974];

au_meters = 1.495978707e11;
mu = 1.32712440018e20;

lat = 60.205490;
lon = 24.0206;

lat = 60.1984210;
lon = 24.7503;
alt = 51.788;

JTs = julian_time_ymdhms(2022, 4, 25, 0, 0, 0);
JTs = JTs:(1/24):(JTs + 1);
JTs = JTs - 0.08994 / 86400;

num_times = length(JTs);

AZ = [];
EL = [];

for ind_time = 1:num_times
    JT = JTs(ind_time);

    N = matrix_mod_tod(JT);

    r_ec_earth = vsop87_earth(JT);
    r_ec_uranus = vsop87_uranus(JT-LT_H(ind_time)*60/86400);
    [r_eq_earth, v_eq_earth] = coord_ecl_eq(JT, r_ec_earth, 0 * r_ec_earth);
    [r_eq_uranus, v_eq_uranus] = coord_ecl_eq(JT, r_ec_uranus, 0 * r_ec_uranus);

    r_j2000 = r_eq_uranus - r_eq_earth;
    r_j2000 = aberration_stellar_cart(JT, r_j2000, 0 * r_j2000);

    [r_mod, v_mod] = coord_j2000_mod(JT, r_j2000, 0 * r_j2000);
    [r_tod, v_tod] = coord_mod_tod(JT, r_mod, v_mod, N);
    [r_pef, v_pef] = coord_tod_pef(JT, r_tod, v_tod, N);
    [r_efi, v_efi] = coord_pef_efi(r_pef, v_pef, 0.1362/3600, 0.4693/3600);
    [slat, slon, sh] = coord_efi_wgs84(r_efi);
    [r_enu, v_enu] = coord_efi_enu(r_efi, v_efi, lat, lon, 0);
    [az, el] = coord_enu_azel(r_enu, v_enu);

    AZ = [AZ; az];
    EL = [EL; el];
end

figure(1);
clf;
subplot(2, 1, 1);
plot(0:24, 3600*min(mod(AZ - AZ_H, 360), mod(AZ_H - AZ, 360)), 'LineWidth', 2);
xlabel('Hour');
ylabel('Azimuth error (arcseconds)');
title('Error in the Position of the Uranus w.r.t. JPL Horizons - 25.04.2022');
grid on;
set(gca, 'xtick', 0:24);
xlim([0 24]);

subplot(2, 1, 2);
plot(0:24, 3600*mod(abs(EL - EL_H), 360), 'LineWidth', 2);
xlabel('Hour');
ylabel('Elevation error (arcseconds)');
grid on;
set(gca, 'xtick', 0:24);
xlim([0 24]);
